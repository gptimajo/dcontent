/* DContent v1.0 | fred@atissoftware.com */
if(jQuery){var DContent=function(){function t(t,r){if(t instanceof jQuery){if(t.size()>1){var i=[];t.each(function(e,t){i.push(new DContent(t,r))});return i}else{e.target=jQuery(t);if(r)n.set(r)}}return null}function c(e){e=e.replace(/[\']+/img,"\\'");e=e.replace(/[\"]+/img,"\"");return e}function h(e){return e?jQuery("<div />").text(e).html():""}function p(e){return e?$("<div />").html(e).text():""}function d(t){t=t?t:e.target;var n=jQuery(t).val();return jQuery("<div>"+n+"</div>")}function v(t){t=t?jQuery(t):e.target;var n=d(t);if(n.html()){if(!/dc\-(txt|lst|tbl)/i.test(n.html())){var i=document.createElement("div");i.id="dc-txt"+(new Date).getTime();i.innerHTML="<div>"+n.html()+"</div>";r.text._set(jQuery(i),true)}else{n.children().each(function(e,t){var n=$(t);var i,s=n.attr("id"),o=s.substr(3,3);switch(o){case"txt":r.text._set(n);break;case"lst":r.list._set(n);break;case"tbl":r.table._set(n);break}})}}}function m(t,n){n=n?jQuery(n):e.target;var i=t.parents(".element-container:eq(0)"),s=i.attr("id").replace(/\-element$/,""),o=i.attr("class").split(" "),u=o[1].replace(/container$/,"");var a=d(n);if(a.find("#"+s).size()){var f=r[u]["_get"](i);var l=a;l.find("#"+s).replaceWith(f);n.val(l.html())}else{g(n)}}function g(t){var n="";t=t?t:e.target;var i=jQuery(e.element),s=i.find("> .dcontent-container").children();s.each(function(e,t){var i=jQuery(t),s=i.attr("class");s=s.split(" ");var o=s[1].replace(/container/,"");n+=r[o]["_get"](i)});t.val(n)}function b(){y.element();y.container();y.controls();e.element.data("dcontent",e);v()}function S(e){if(typeof e.selectionStart=="number"){e.selectionStart=e.selectionEnd=e.value.length}else if(typeof e.createTextRange!="undefined"){e.focus();var t=e.createTextRange();t.collapse(false);t.select()}}function x(e){var t=e.split(/[\-\_]/);var n=t[0];if(t.length>1){for(var r=1;r<t.length;r++){n+=t[r].substr(0,1).toUpperCase()+t[r].substr(1).toLowerCase()}}return n}var e=this;e.target=null;e.element=null;var n={values:{},set:function(e,t){var r=jQuery.isEmptyObject(n.values)?n.defaults:n.values;if(e instanceof Object){for(var i in e){if(r[i])r[i]=e[i]}}else if(e instanceof String&&t){if(r[e])r[e]=t}n.values=r},get:function(e){var t=jQuery.isEmptyObject(n.values)?n.defaults:n.values;return e?t[e]!=undefined?t[e]:null:t},defaults:{controls:["text","list","table","image","video"],tinymce_path:"./js/tinymce/tiny_mce.js"}};e.getConfig=n.get;e.setConfig=n.set;var r={text:{_tinymce_settings:{script_url:n.get("tinymce_path"),width:"100%",height:300,theme:"advanced",theme_advanced_buttons1:"bold,italic,underline,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,|,link",theme_advanced_buttons2:"",theme_advanced_buttons3:"",theme_advanced_buttons4:"",theme_advanced_toolbar_align:"bottom",theme_advanced_toolbar_location:"bottom",theme_advanced_statusbar_location:"none",plugins:"paste",paste_text_sticky:true,setup:function(e){e.onInit.add(function(e){e.pasteAsPlainText=true})},handle_event_callback:function(e,t){if(e.type=="keyup"){t.save();var n=jQuery("#"+t.editorId),r=n.parents(".dcontent-element").data("dcontent");r.update(n)}}},add:function(e){var t=r.text._create();var n=jQuery(e[0].currentTarget);n.parent().siblings(".dcontent-container").append(t);t.find("input[type=hidden]").tinymce(r.text._tinymce_settings);r.text._apply()},remove:function(e){if(confirm("Delete text?")){var t=jQuery(e.currentTarget);t.parent().parent().remove();g()}},_create:function(e,t){e=(e?e:"dc-txt"+(new Date).getTime())+"-element";var n=jQuery("<div>").addClass("element-container textcontainer").attr("id",e);var r=jQuery("<div>").addClass("text-controls");jQuery("<a>").attr("href","#").addClass("text-control remove-text").html("Remove Text").appendTo(r);n.append(r);if(t){jQuery('<input type="hidden" />').attr("value",t).appendTo(n)}else jQuery('<input type="hidden" />').appendTo(n);return n},_apply:function(){jQuery(".text-control").unbind("click").bind("click",function(e){var t=jQuery(this),n=this.className.split(" ");var r=jQuery(t.parents(".dcontent-element")).data("dcontent");var i=x(n[1]);r[i](e);return false});jQuery(".textcontainer input[type=text]").unbind("change").bind("change",function(){var e=jQuery(this),t=e.parents(".dcontent-element").data("dcontent");t.update(e)})},_get:function(e){var t=jQuery(e),n=t.attr("id").replace(/\-element$/,"");var r='<div id="'+n+'">';var i=t.find("> input[type=hidden]");r+=i.val();r+="</div>";return r},_set:function(t){var n=r.text._create(t.attr("id"),t.html());n.find("input[type=hidden]").tinymce(r.text._tinymce_settings);e.element.find(".dcontent-container").append(n);r.text._apply()}},list:{_tinymce_settings:{content_css:"css/dcontent.tinymce.css",script_url:n.get("tinymce_path"),width:200,height:32,theme_advanced_resizing_min_height:32,theme:"advanced",theme_advanced_buttons1:"bold,italic,|,link",theme_advanced_buttons2:"",theme_advanced_buttons3:"",theme_advanced_buttons4:"",theme_advanced_toolbar_align:"bottom",theme_advanced_toolbar_location:"external",theme_advanced_statusbar_location:"none",theme_advanced_source_editor_wrap:false,valid_elements:"a[href|target=_blank],strong/b,em/i,u",plugins:"paste",force_br_newlines:false,force_p_newlines:false,force_root_block:false,paste_text_sticky:true,setup:function(e){e.onInit.add(function(e){e.pasteAsPlainText=true});e.onKeyDown.addToTop(function(e,t){if(t.charCode==13||t.keyCode==13){var n=jQuery(e.getElement());var r=n.parents(".element-container");r.find(".list-controls .list-control.add-item-list").trigger("click");e.save();return tinymce.dom.Event.cancel(t)}})},init_instance_callback:function(e){$("#"+e.editorContainer).find("td.mceIframeContainer iframe, table.mceLayout").height(32)}},_item:'<li><input type="text" /><a href="#" class="list-control remove-item-list" title="Remove List">Remove List</a></li>',add:function(e){var t=r.list._create();var n=jQuery(e[0].currentTarget);n.parent().siblings(".dcontent-container").append(t);r.list._apply()},remove:function(e){if(confirm("Delete list?")){var t=jQuery(e.currentTarget);t.parent().parent().remove();g()}},type:{select:function(e){var t=e.currentTarget;var n=t.className.split(" ");if(n[2]){if(n[2]=="to-num-list"){jQuery(t).removeClass("to-num-list").addClass("to-bul-list");var i=jQuery(t).parent().prev(),s=i.children().clone(true,true);var o=jQuery("<ol>");o.append(s);o.find(".mceEditor").remove();o.find("input[type=text]").removeAttr("id").removeAttr("aria-hidden").removeAttr("style");i.replaceWith(o)}if(n[2]=="to-bul-list"){jQuery(t).removeClass("to-bul-list").addClass("to-num-list");var o=jQuery(t).parent().prev(),s=o.children().clone(true,true);var i=jQuery("<ul>");i.append(s);i.find(".mceEditor").remove();i.find("input[type=text]").removeAttr("id").removeAttr("aria-hidden").removeAttr("style");o.replaceWith(i)}r.list._apply()}}},item:{add:function(e){var t=jQuery(e.currentTarget),n=jQuery(r.list._item);t.parent().siblings("ul,ol").append(n);r.list._apply()},remove:function(e){if(confirm("Delete item?")){var t=jQuery(e.currentTarget);t.parent().remove()}}},_create:function(e,t){e=(e?e:"dc-lst"+(new Date).getTime())+"-element";var n=jQuery("<div>").addClass("element-container listcontainer").attr("id",e);var i=jQuery("<div>").addClass("list-controls");jQuery("<a>").attr("href","#").addClass("list-control add-item-list").html("Add Item").appendTo(i);jQuery("<a>").attr("href","#").addClass("list-control select-type-list to-num-list").html("Change List Type").appendTo(i);jQuery("<a>").attr("href","#").addClass("list-control remove-list").html("Remove List").appendTo(i);n.append(i);if(t){t.find("> li").each(function(e,t){var n=h(jQuery(t).html());n=c(n);var i=r.list._item;i=i.replace(/input/,'input value="'+n+'"');var s=jQuery(i);s.find("> input[type=text]");if(n)jQuery(t.firstChild).replaceWith(s.html());else jQuery(t).append(s.html())});jQuery(t).prependTo(n)}else jQuery("<ul>"+r.list._item+"</ul>").prependTo(n);return n},_apply:function(){jQuery(".list-control").unbind("click").bind("click",function(e){var t=jQuery(this),n=this.className.split(" ");var r=jQuery(t.parents(".dcontent-element")).data("dcontent");var i=x(n[1]);r[i](e);return false});jQuery(".listcontainer input[type=text]").each(function(e,t){var n=jQuery(t);if(!/^mce_/.test(n.attr("id"))){n.tinymce(r.list._tinymce_settings)}})},_get:function(e){var t=jQuery(e),n=jQuery("<div>").attr("id",t.attr("id").replace(/\-element$/,""));var r=t.children().prop("tagName").toLowerCase();r=jQuery("<"+r+">");t.find("li > input[type=text]").each(function(e,t){var n=jQuery(t);console.log(n.val());jQuery("<li>").html(n.val()).appendTo(r)});r.appendTo(n);var i=jQuery("<div>").append(n);return i.html();elementContainer.find("ul > li > input[type=text], ol > li > input[type=text]").each(function(e,t){var n=jQuery(t).val();jQuery(t).parent().prepend(n);jQuery(t).siblings(".list-control, .mceEditor").remove();jQuery(t).remove()});elementContainer.find(".list-controls").remove();elementContainer.find(".listcontainer").each(function(e,t){var n=jQuery(t),r=n.attr("id");var i=r.replace(/\-element$/,"");n.attr({id:i,"class":null})});var s=elementContainer.attr("id"),o=s.replace(/\-element$/,"");elementContainer.attr({id:o,"class":null});var u=jQuery("<div>").append(elementContainer);return u.html()},_set:function(t,n){n=n?n:false;var i=r.list._create(t.attr("id"),t.children());if(n)return i;else e.element.find(".dcontent-container").append(i);r.list._apply()}},table:{_columncontrols:'<a href="#" class="table-control remove-column-table" title="Remove Current Column">Remove Column</a><a href="#" class="table-control add-column-table" title="Add Column to the Right">Add Column</a>',_rowcontrols:'<a href="#" class="table-control remove-row-table" title="Delete Current Row">Delete Row</a><a href="#" class="table-control add-row-table" title="Add Row Below">Add Row</a>',_field:'<td><input type="text" /></td>',_tinymce_settings:{content_css:"css/dcontent.tinymce.css",script_url:n.get("tinymce_path"),width:65,height:30,theme_advanced_resizing_min_height:32,theme:"advanced",theme_advanced_buttons1:"bold,italic,|,link",theme_advanced_buttons2:"",theme_advanced_buttons3:"",theme_advanced_buttons4:"",theme_advanced_toolbar_align:"bottom",theme_advanced_toolbar_location:"external",theme_advanced_statusbar_location:"none",theme_advanced_source_editor_wrap:false,valid_elements:"a[href|target=_blank],strong/b,em/i,u",plugins:"paste,autosave",force_br_newlines:false,force_p_newlines:false,force_root_block:false,paste_text_sticky:true,setup:function(e){e.onInit.add(function(e){e.pasteAsPlainText=true;jQuery(e.getContainer()).mouseleave(function(){jQuery(e.getContainer()).find(".mceExternalToolbar").css("display","none")}).mouseenter(function(){jQuery(e.getContainer()).find(".mceExternalToolbar").css("display","block")})});e.onKeyDown.addToTop(function(e,t){if(t.charCode==13||t.keyCode==13){var n=jQuery(e.getElement());var r=n.parents(".element-container");r.find(".list-controls .list-control.add-item-list").trigger("click");e.save();return tinymce.dom.Event.cancel(t)}})},init_instance_callback:function(e){$("#"+e.editorContainer).find("td.mceIframeContainer iframe, table.mceLayout").height(32)}},add:function(e){var t=r.table._create();var n=jQuery(e[0].currentTarget);n.parent().siblings(".dcontent-container").append(t);r.table._apply()},remove:function(e){if(confirm("Delete table?")){var t=jQuery(e.currentTarget);t.parent().parent().remove();g()}},row:{add:function(e){var t=jQuery(e.currentTarget);var n=t.parents("tr");var i=jQuery("<tr></tr>");for(var s=0;s<n.children("td").size()-1;s++){jQuery(r.table._field).appendTo(i)}jQuery("<td>"+r.table._rowcontrols+"</td>").appendTo(i);i.insertAfter(n);r.table._apply()},remove:function(e){if(confirm("Delete Row?")){var t=jQuery(e.currentTarget);var n=t.parents("tr");n.remove()}}},column:{add:function(e){var t=jQuery(e.currentTarget);var n=t.parent(),i=n.parent();var s=n.prevAll().size();var o=i.siblings().find("> td:eq("+s+")");jQuery(r.table._field).insertAfter(o);jQuery("<td>"+r.table._columncontrols+"</td>").insertAfter(n);r.table._apply()},remove:function(e){if(confirm("Delete Column?")){var t=jQuery(e.currentTarget);var n=t.parent(),r=n.parent();var i=n.prevAll().size();r.find("td:eq("+i+")").remove();r.siblings().find("td:eq("+i+")").remove()}}},_create:function(e,t){e=(e?e:"dc-tbl"+(new Date).getTime())+"-element";var n=jQuery("<div>").addClass("element-container tablecontainer").attr("id",e);var i=jQuery("<div>").addClass("table-controls");jQuery("<a>").attr("href","#").addClass("table-control remove-table").html("Remove Table").appendTo(i);n.append(i);if(t){t.find("td").each(function(e,t){t=jQuery(t);var n=t.html();t.html("");t.append(jQuery("<input/>").attr({type:"text",value:n}))});var s=t.find("tr:first-child td").size();t.find("tr").each(function(e,t){jQuery(t).append("<td>"+r.table._rowcontrols+"</td>")});var o=jQuery("<tr>");for(var u=0;u<s;u++){jQuery("<td>"+r.table._columncontrols+"</td>").appendTo(o)}jQuery("<td> </td>").appendTo(o);var s=t.find("tr:first > td").size()-1;var u=0,a=jQuery("<tr>");while(u++<s){jQuery("<td>").html(r.table._columncontrols).appendTo(a)}a.appendTo(t);jQuery("<div>").append(t).prependTo(n)}else jQuery('<div><table><tr><td><input type="text" /></td><td><input type="text" /></td><td><input type="text" /></td><td>'+r.table._rowcontrols+'</td></tr><tr><td><input type="text" /></td><td><input type="text" /></td><td><input type="text" /></td><td>'+r.table._rowcontrols+"</td></tr><tr><td>"+r.table._columncontrols+"</td><td>"+r.table._columncontrols+"</td><td>"+r.table._columncontrols+"</td></tr></table></div>").prependTo(n);return n},_apply:function(){jQuery(".table-control").unbind("click").bind("click",function(e){var t=jQuery(this),n=this.className.split(" ");var r=jQuery(t.parents(".dcontent-element")).data("dcontent");var i=x(n[1]);r[i](e);return false});jQuery(".tablecontainer input[type=text]").tinymce(r.table._tinymce_settings)},_get:function(e){var t=jQuery(e),n=t.attr("id").replace(/\-element$/,"");var r='<div id="'+n+'"><table>';var i=t.find("> div > table").clone(true);var s=i.children().children();for(var o=0;o<s.size()-1;o++){var u=jQuery(s[o]);r+="<tr>";var a=u.children();for(var f=0;f<a.size()-1;f++){var l=jQuery(a[f]);r+="<td>"+l.find("input[type=text]").val()+"</td>"}r+="</tr>"}r+="</table></div>";return r},_set:function(t){var n=r.table._create(t.attr("id"),t.find("> table"));e.element.find(".dcontent-container").append(n);r.table._apply()}},image:{add:function(){},remove:function(){}},video:{add:function(){},remove:function(){}}};for(var i in r){var s=i;for(var o in r[i]){var u=o,a;if(!/^\_/.test(u)){if(r[i][o]instanceof Function){a=x(u+"-"+s);e[a]=r[i][o]}else{var f=u;for(var l in r[i][o]){u=l;a=x(u+"-"+f+"-"+s);e[a]=r[i][o][l]}}}}}this.update=m;this.save=g;var y={element:function(){var t=jQuery(".dcontent-element").size()+1;e.element=jQuery("<div>").attr("id","dcontent-el"+t).addClass("dcontent-element").css({width:e.target.width()}).insertAfter(e.target);e.target.css("display","none")},container:function(){var t=jQuery("<div>").addClass("dcontent-container");t.appendTo(e.element)},controls:function(){var t=jQuery("<div>").addClass("dcontent-controls");var r=n.get()["controls"];for(var i=0;i<r.length;i++){switch(r[i]){case"text":jQuery("<a>").attr({href:"#",title:"Add Text"}).addClass("text").html("Add Text").appendTo(t);break;case"list":jQuery("<a>").attr({href:"#",title:"Add List"}).addClass("list").html("Add List").appendTo(t);break;case"table":jQuery("<a>").attr({href:"#",title:"Add Table"}).addClass("table").html("Add Table").appendTo(t);break;case"image":jQuery("<a>").attr({href:"#",title:"Add Image"}).addClass("image").html("Add Image").appendTo(t);break;case"video":jQuery("<a>").attr({href:"#",title:"Add Video"}).addClass("video").html("Add Video").appendTo(t);break}}t.children().unbind("click");t.children().bind("click",function(){var e="add"+this.className.substr(0,1).toUpperCase()+this.className.substr(1).toLowerCase();var t=jQuery(this);var n=jQuery(t.parentsUntil(".dcontent-element").parent()).data("dcontent");n[e](arguments);return false});t.appendTo(e.element)}};var w=arguments;if(w.length==0)return null;if(w[0]){var E=t(jQuery(w[0]),w[1]);if(E)return E;b()}}}else{alert("Cannot load DContent Javascript Class, jQuery is required.")}